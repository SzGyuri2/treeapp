<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>F≈ëoldal ‚Äì Fa√ºltet≈ë App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
/* Megl√©v≈ë st√≠lusok */
body { font-family: Arial, sans-serif; }
header { display:flex; justify-content:space-between; }

/* √öj reszponz√≠v szab√°lyok */
@media (max-width:768px) {
  .stats { grid-template-columns: 1fr; }
  .row { flex-direction: column; }
}

@media (max-width:480px) {
  header { flex-direction: column; gap:12px; }
  .logo { width:36px; height:36px; font-size:20px; }
  .value { font-size:18px; }
  select, button { width:100%; }
}
    :root { --bg:#06131a; --panel:#0b1c23; --text:#e6f3ee; --muted:#9fb7ae; --accent:#22c55e; --primary:#4cb8ff; --warn:#fbbf24; }
    *{box-sizing:border-box}
    body { margin:0; background: radial-gradient(1200px 600px at 70% 10%, #0e2230 0%, #06131a 60%, #030a0f 100%); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #14313e; }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo { width:44px; height:44px; border-radius:12px; background:linear-gradient(135deg,#22c55e,#4ade80); display:grid; place-items:center; font-size:24px; box-shadow:0 10px 30px rgba(34,197,94,.35); }
    .container { display:grid; grid-template-columns:1.3fr .7fr; gap:18px; padding:18px; }
    @media (max-width:980px){ .container{ grid-template-columns:1fr; } }
    .card { background:rgba(11,28,35,.65); border:1px solid #14313e; border-radius:14px; padding:16px; box-shadow:0 16px 48px rgba(0,0,0,.45); }
    .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .stat { background:#071920; border:1px solid #14313e; border-radius:12px; padding:12px; }
    .label { color:var(--muted); font-size:12px; }
    .value { font-size:22px; font-weight:800; margin-top:4px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    select, button { padding:12px 14px; border-radius:10px; border:1px solid #14313e; background:#082029; color:var(--text); cursor:pointer; }
    .btn { font-weight:700; }
    .btn-primary { background:linear-gradient(180deg, #6bd0ff, #2f9be6); color:#03243a; }
    .btn-accent { background:linear-gradient(180deg, #34d399, #22c55e); color:#06291a; }
    .btn-warn { background:linear-gradient(180deg, #fbbf24, #f59e0b); color:#1f2937; }
    .plant-stage { position:relative; height:240px; margin-top:10px; background: linear-gradient(180deg, rgba(22,78,45,.25), rgba(5,22,12,.12)); border:1px solid #16523a; border-radius:14px; overflow:hidden; }
    .ground { position:absolute; bottom:0; left:0; right:0; height:52px; background:linear-gradient(180deg, #14532d, #064e3b); border-top:2px solid #22c55e; }
    .sprout, .sapling, .tree { position:absolute; left:50%; transform:translateX(-50%); bottom:-120px; font-size:36px; filter:drop-shadow(0 8px 10px rgba(0,0,0,.4)); opacity:0; }
    .sprout.show { animation: grow1 600ms ease-out forwards; }
    .sapling.show { animation: grow2 700ms ease-out 550ms forwards; }
    .tree.show { animation: grow3 800ms ease-out 1100ms forwards, sway 2800ms ease-in-out 2s infinite alternate; }
    @keyframes grow1 { 0%{bottom:160px;opacity:0;transform:translateX(-50%) scale(.5)} 100%{bottom:48px;opacity:1;transform:translateX(-50%) scale(.9)}}
    @keyframes grow2 { 0%{bottom:120px;opacity:0;transform:translateX(-50%) scale(.6)} 100%{bottom:50px;opacity:1;transform:translateX(-50%) scale(1)}}
    @keyframes grow3 { 0%{bottom:100px;opacity:0;transform:translateX(-50%) scale(.6)} 100%{bottom:54px;opacity:1;transform:translateX(-50%) scale(1.05)}}
    @keyframes sway { 0% { transform:translateX(-50%) rotate(-1deg); } 100% { transform:translateX(-50%) rotate(1deg); } }
    .feed { display:flex; flex-direction:column; gap:8px; max-height:420px; overflow:auto; }
    .feed-item { display:flex; justify-content:space-between; padding:8px; border:1px dashed #14313e; border-radius:10px; background:#071920; }
    .leader { margin-top:8px; }
    .rowbar { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .bar { flex:1; height:12px; border-radius:8px; background:linear-gradient(90deg, #22c55e, #4ade80); box-shadow: inset 0 0 6px rgba(0,0,0,.35); }
    .bar-inner { height:100%; border-radius:8px; background:linear-gradient(90deg, #6bd0ff, #2f9be6); width:0%; transition:width .6s ease; }
    .badge { font-size:18px; }
    .toast { position:fixed; left:50%; transform:translateX(-50%); bottom:22px; background:#041219; border:1px solid #14313e; color:#e6f3ee; padding:12px 16px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.45); opacity:0; pointer-events:none; transition: opacity .2s ease, transform .2s ease; }
    .toast.show { opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(-4px); }
    .section-title { display:flex; justify-content:space-between; align-items:center; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">üåç</div>
      <div>
        <div style="font-weight:800">Fa√ºltet≈ë App ‚Äì F≈ëoldal</div>
        <div style="font-size:12px; color:#9fb7ae;">Z√∂ld diz√°jn, t√∂bb anim√°ci√≥, √©l≈ë √ºltet√©si feed</div>
      </div>
    </div>
    <div class="row">
      <a class="btn btn-primary" href="chat.html">Seg√≠ts√©g chat</a>
      <a class="btn btn-primary" href="index.html">Kijelentkez√©s</a>
    </div>
  </header>

  <main class="container">
    <section class="card" id="treesSection">
      <div class="section-title">
        <h2>Profil √©s fa√ºltet√©s</h2>
        <div class="row">
          <button class="btn btn-warn" onclick="window.location.href='coins.html'">Coin v√°s√°rl√°s</button>
          <button class="btn btn-primary" onclick="scrollToTrees()">Vissza a f√°khoz</button>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="label">Felhaszn√°l√≥</div><div class="value" id="userName">‚Äì</div></div>
        <div class="stat"><div class="label">Coin egyenleg</div><div class="value" id="coins">0</div></div>
        <div class="stat"><div class="label">√últetett f√°k</div><div class="value" id="trees">0</div></div>
      </div>

            <div class="row" style="margin-top:8px;">
        <select id="treeSelect">
          <option value="100" data-type="T√∂lgy" data-sprout="üå±" data-sapling="üåø" data-tree="üå≥">T√∂lgy ‚Äî 100 coin</option>
          <option value="80" data-type="Juhar" data-sprout="üå±" data-sapling="üåø" data-tree="üçÅ">Juhar ‚Äî 80 coin</option>
          <option value="60" data-type="Ny√°r" data-sprout="üå±" data-sapling="üåø" data-tree="üå¥">Ny√°r ‚Äî 60 coin</option>
          <option value="120" data-type="Feny≈ë" data-sprout="üå±" data-sapling="üåø" data-tree="üå≤">Feny≈ë ‚Äî 120 coin</option>
          <option value="150" data-type="Cseresznye" data-sprout="üå±" data-sapling="üåø" data-tree="üå∏">Cseresznye ‚Äî 150 coin</option>
        </select>
        <button class="btn btn-accent" id="buyTreeBtn">Fa v√°s√°rl√°sa</button>
      </div>

      <div class="plant-stage" id="stage">
        <div class="ground"></div>
        <div class="sprout" id="sprout">üå±</div>
        <div class="sapling" id="sapling">üåø</div>
        <div class="tree" id="tree">üå≥</div>
      </div>
    </section>

    <section class="card">
      <h2>Rangsor</h2>
      <div id="leaderboard" class="leader"></div>
    </section>

    <section class="card">
      <h2>√âl≈ë √ºltet√©si feed (maradand√≥ nyom)</h2>
      <div id="feed" class="feed"></div>
    </section>
  </main>

  <div class="toast" id="toast">M≈±velet sikeres</div>

  <script>
    const USERS_KEY = 'users_v2';
    const FEED_KEY = 'feed_v1';

    function loadUsers(){ return JSON.parse(localStorage.getItem(USERS_KEY) || '[]'); }
    function saveUsers(users){ localStorage.setItem(USERS_KEY, JSON.stringify(users)); }
    function loadFeed(){ return JSON.parse(localStorage.getItem(FEED_KEY) || '[]'); }
    function saveFeed(feed){ localStorage.setItem(FEED_KEY, JSON.stringify(feed)); }

    const el = id => document.getElementById(id);
    const toast = (msg) => { const t = el('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 1600); };

    const currentUserId = Number(sessionStorage.getItem('currentUserId')||0);
    if (!currentUserId) window.location.href = 'index.html';

    let users = loadUsers();
    let user = users.find(u => u.id === currentUserId);
    if (!user) { alert('Felhaszn√°l√≥ nem tal√°lhat√≥.'); window.location.href='index.html'; }

    function renderProfile(){
      el('userName').textContent = user.username || user.email;
      el('coins').textContent = user.coins;
      el('trees').textContent = user.trees;
    }

    function scrollToTrees(){ document.getElementById('treesSection').scrollIntoView({ behavior: 'smooth' }); }

    function playMultiStageAnimation(sproutEmoji, saplingEmoji, treeEmoji){
      el('sprout').textContent = sproutEmoji;
      el('sapling').textContent = saplingEmoji;
      el('tree').textContent = treeEmoji;
      ['sprout','sapling','tree'].forEach(id => el(id).classList.remove('show'));
      void el('stage').offsetWidth;
      el('sprout').classList.add('show');
      el('sapling').classList.add('show');
      el('tree').classList.add('show');
    }

    function pushFeedEntry(type, price){
      const feed = loadFeed();
      feed.unshift({
        id: Date.now(),
        user: user.username || user.email,
        type, price,
        time: new Date().toLocaleString()
      });
      saveFeed(feed);
      renderFeed();
    }

    function renderFeed(){
      const feed = loadFeed();
      const box = el('feed'); box.innerHTML = '';
      feed.forEach(item => {
        const row = document.createElement('div');
        row.className = 'feed-item';
        row.innerHTML = `<span>üå± ${item.user} √ºltetett: ${item.type} (${item.price} coin)</span><small>${item.time}</small>`;
        box.appendChild(row);
      });
    }

    function renderLeaderboard(){
  const ranked = [...loadUsers()].sort((a,b)=> b.trees - a.trees);
  const maxTrees = Math.max(1, ranked[0]?.trees || 1);
  const box = el('leaderboard'); // <-- jav√≠tva
  box.innerHTML = '';
  ranked.forEach((u,i) => {
    const pct = Math.round((u.trees / maxTrees)*100);
    const badge = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'üåø';
    const row = document.createElement('div');
    row.className = 'rowbar';
    row.innerHTML = `<span class="badge">${badge}</span><strong>${u.username || u.email}</strong><span style="color:#9fb7ae">f√°k: ${u.trees} ‚Ä¢ coin: ${u.coins}</span>`;
    const bar = document.createElement('div'); bar.className = 'bar';
    const inner = document.createElement('div'); inner.className = 'bar-inner'; inner.style.width = pct + '%';
    bar.appendChild(inner); box.appendChild(row); box.appendChild(bar);
  });
}


    async function buyTree(){
      const opt = el('treeSelect').selectedOptions[0];
      const price = Number(opt.value);
      const type = opt.dataset.type;
      const sprout = opt.dataset.sprout;
      const sapling = opt.dataset.sapling;
      const tree = opt.dataset.tree;

      if (user.coins < price) { toast('Nincs el√©g coin'); return; }
      user.coins -= price; user.trees += 1;
      users = users.map(u => u.id === user.id ? user : u); saveUsers(users);
      renderProfile();
      playMultiStageAnimation(sprout, sapling, tree);
      pushFeedEntry(type, price);
      renderLeaderboard(); // rangsor azonnali friss√≠t√©se
      toast(`El√ºltetve: ${type}`);
    }

    document.getElementById('buyTreeBtn').addEventListener('click', buyTree);

    // Inicializ√°l√°s
    renderProfile();
    renderLeaderboard();
    renderFeed();
  </script>
</body>
</html>
