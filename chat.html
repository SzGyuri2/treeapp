<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Seg√≠ts√©g chat ‚Äì Fa√ºltet≈ë App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Megl√©v≈ë st√≠lusok */
body { font-family: Arial, sans-serif; }
header { display:flex; justify-content:space-between; }

/* √öj reszponz√≠v szab√°lyok */
@media (max-width:768px) {
  .stats { grid-template-columns: 1fr; }
  .row { flex-direction: column; }
}

@media (max-width:480px) {
  header { flex-direction: column; gap:12px; }
  .logo { width:36px; height:36px; font-size:20px; }
  .value { font-size:18px; }
  select, button { width:100%; }
}
    :root { --bg:#06131a; --card:#0b1c23; --text:#e6f3ee; --muted:#9fb7ae; --primary:#4cb8ff; --accent:#22c55e; }
    body { margin:0; background: radial-gradient(1200px 600px at 70% 10%, #0e2230 0%, #06131a 60%, #030a0f 100%); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #14313e; }
    .container { max-width:900px; margin:18px auto; padding:16px; }
    .card { background: rgba(11,28,35,.7); border:1px solid #14313e; border-radius:16px; padding:16px; box-shadow:0 16px 48px rgba(0,0,0,.45); }
    .chat { display:flex; flex-direction:column; gap:8px; max-height:60vh; overflow:auto; padding:8px; background:#071920; border:1px solid #14313e; border-radius:12px; }
    .bubble { max-width:75%; padding:10px 12px; border-radius:12px; }
    .user { align-self:flex-end; background:linear-gradient(180deg,#6bd0ff,#2f9be6); color:#03243a; }
    .bot { align-self:flex-start; background:#0b1c23; border:1px solid #14313e; }
    .row { display:flex; gap:8px; margin-top:10px; }
    input { flex:1; padding:12px; border-radius:10px; background:#082029; color:#e6f3ee; border:1px solid #14313e; }
    button { padding:12px 14px; border-radius:10px; border:1px solid #14313e; background:#082029; color:#e6f3ee; cursor:pointer; font-weight:700; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 8px; }
  </style>
</head>
<body>
  <header>
    <div>üåç Seg√≠ts√©g chat</div>
    <a href="index.html" style="color:#4cb8ff;">Vissza</a>
  </header>
  <div class="container">
    <div class="card">
      <div id="chat" class="chat"></div>
      <div class="row">
        <input id="prompt" placeholder="√çrd be, miben seg√≠thetek‚Ä¶ (pl. hogyan veszek coint?)">
        <button id="sendBtn">K√ºld√©s</button>
      </div>
      <div class="hint">Tipp: k√©rdezhetsz coin v√°s√°rl√°sr√≥l, fa√ºltet√©sr≈ël, rangsorr√≥l, √©l≈ë feedr≈ël, regisztr√°ci√≥r√≥l √©s bejelentkez√©sr≈ël.</div>
    </div>
  </div>

  <script>
    // OpenRouter API kulcsod
    const OPENROUTER_API_KEY = "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";
    const MODEL = "openai/gpt-4o-mini"; // v√°lthatsz pl. "meta-llama/Llama-3-8b-chat-hf"-re

    // System prompt: identit√°s + hangnem + feladat
    const SYSTEM_PROMPT = `
Te egy k√∂rnyezetv√©d≈ë Fa√ºltet≈ë App be√©p√≠tett seg√≠t≈ëje vagy. Feladatod:
- Adj pontos, l√©p√©sr≈ël-l√©p√©sre √∫tmutat√≥t az app funkci√≥ira (coin v√°s√°rl√°s, fa√ºltet√©s, rangsor, √©l≈ë √ºltet√©si feed, vissza gomb, chat, regisztr√°ci√≥ √©s bejelentkez√©s).
- Legy√©l empatikus √©s l√©nyegre t√∂r≈ë; ha hib√°t √≠r a rendszer, magyar√°zd el, mi√©rt, √©s hogyan jav√≠that√≥.
- R√∂viden is tudj v√°laszolni, de ha a k√©r√©s ig√©nyli, adj r√©szletes, teljes k√∂r≈± v√°laszt.
- Soha ne adj hamis √≠g√©retet. Ha valami a kliens oldalon korl√°tos (pl. e-mail k√ºld√©s), jelezd √©s adj m≈±k√∂d≈ë ker√ºl≈ëutakat.
`;

    // Alkalmaz√°s tud√°sb√°zis ‚Äì r√©szletes, kifejezett v√°laszokhoz
    const KB = `
[Alkalmaz√°s f≈ë funkci√≥k]
- Coin v√°s√°rl√°s: coins.html oldalon gombokkal (+100, +500, +1000). J√≥v√°√≠r√°s azonnal, anim√°lt egyenleg friss√≠t√©ssel. Vissza gomb: app.html#treesSection.
- Fa√ºltet√©s: app.html f≈ëoldalon a "Fa v√°s√°rl√°sa" gomb. A f√°k √°ra (p√©lda): T√∂lgy 100, Juhar 80, Ny√°r 60, Feny≈ë 120, Cseresznye 150 coin. √últet√©skor t√∂bbf√°zis√∫ anim√°ci√≥ (üå± ‚Üí üåø ‚Üí üå≥/üå≤/üå¥/üçÅ/üå∏), coin levon√°s, f√°k sz√°ma n√∂vekszik.
- √âl≈ë √ºltet√©si feed: jobb oldali panelben (app.html) napl√≥zza, ki milyen f√°t √ºltetett √©s mennyi coin√©rt, id≈ëb√©lyeggel. Maradand√≥: localStorage-ban ≈ërizz√ºk (feed_v1).
- Rangsor: badge-ek (ü•á/ü•à/ü•â/üåø), anim√°lt s√°v jelzi a f√°k sz√°m√°t. Rendez√©s: √ºltetett f√°k sz√°ma szerint. Mutatja a coin √©s fa √©rt√©ket is.
- Vissza gomb: a f≈ëoldalon "Vissza a f√°khoz" a fa szekci√≥hoz g√∂rget; a coins.html visszavisz k√∂zvetlen√ºl az app.html#treesSection szekci√≥ra.

[Regisztr√°ci√≥ √©s bejelentkez√©s]
- Regisztr√°ci√≥ (register.html): e-mail bek√©r√©se, gener√°lt felhaszn√°l√≥n√©v √©s jelsz√≥; t√°rol√°s localStorage-ban (users_v2). Opcion√°lis e-mail k√ºld√©s EmailJS-sel (kliens-oldali).
- Bejelentkez√©s (login.html): felhaszn√°l√≥n√©v + jelsz√≥ p√°ros ellen≈ërz√©se localStorage-b√≥l; siker eset√©n sessionStorage-ben t√°roljuk a currentUserId-t, majd app.html-re l√©p√ºnk.
- Biztons√°gi megjegyz√©s: kliens-oldali t√°rol√°s fejleszt≈ëi dem√≥hoz ide√°lis, √©les k√∂rnyezetben szerveroldali auth sz√ºks√©ges.

[Chat]
- Chat oldal: chat.html. OpenRouter API kulccsal h√≠vja a modellt. Ha kv√≥ta hiba van vagy nincs v√°lasz, jelezd √©s adj alternat√≠v√°t (pl. r√∂vid offline s√∫g√≥).
- System prompt √©s tud√°sb√°zis alapj√°n az app-specifikus k√©rd√©sekre els≈ëdlegesen az itt le√≠rtak szerint v√°laszol.

[Hibaelh√°r√≠t√°s ‚Äì tipikus probl√©m√°k √©s megold√°sok]
- Nem t√∂lt≈ëdik be a chat: ellen≈ërizd a kulcsot, modellt √©s az internetet; pr√≥b√°ld √∫jra 10‚Äì20s m√∫lva. Ha kv√≥ta hiba: n√©zd meg az OpenRouter fi√≥kot √©s keretet.
- Coin v√°s√°rl√°s nem √≠rja j√≥v√°: friss√≠tsd a b√∂ng√©sz≈ët; ellen≈ërizd, hogy a currentUserId be van-e √°ll√≠tva sessionStorage-ban; a localStorage (users_v2) √≠rhat√≥-e; nem priv√°t m√≥d-e a b√∂ng√©sz≈ë?
- Fa√ºltet√©sn√©l ‚Äûnincs el√©g coin‚Äù: ellen≈ërizd az egyenleget; vegy√©l coint a coins.html-en; kiv√°lasztott fa √°ra lehet magasabb, mint az egyenleg.
- Rangsor nem friss√ºl: √ºltet√©s ut√°n fut-e a renderLeaderboard(); t√∂r√∂ld a cache-t √©s friss√≠tsd az oldalt; ellen≈ërizd a localStorage-ban az adatok v√°ltoz√°s√°t.
- √âl≈ë feed nem mutatja az √∫j √ºltet√©seket: saveFeed/feed_v1 kulcs √≠rhat√≥-e; a pushFeedEntry fut-e √ºltet√©skor; g√∂rgess a feed panelt.
- E-mail k√ºld√©s nem megy: kliens-oldalon k√∂zvetlen√ºl nem lehets√©ges; haszn√°lj EmailJS-t a kliensb≈ël, vagy szerveroldali SMTP-t (Node.js/SES/SendGrid). Ha EmailJS nincs inicializ√°lva, az e-mail k√ºld√©st a k√≥d kihagyja, de a regisztr√°ci√≥ l√©trej√∂n.
- Bejelentkez√©s sikertelen: rossz felhaszn√°l√≥n√©v/jelsz√≥; a regisztr√°ci√≥kor kapott adatokkal l√©pj be; ellen≈ërizd, hogy a users_v2 t√°rolja a bejegyz√©st.

[Haszn√°lati tippek]
- Coin bolt: kezdd +500 cointtal, hogy kipr√≥b√°ld az √∂sszes fa anim√°ci√≥j√°t.
- Rangsor: t√∂bben teszteljetek k√ºl√∂n felhaszn√°l√≥kkal, √≠gy l√°tv√°nyosabb lesz.
- Feed: ha hossz√∫, g√∂rgess; a leg√∫jabb bejegyz√©s fel√ºl jelenik meg.

[Korl√°tok √©s javaslatok]
- A kliens-oldali t√°rol√°s dem√≥ jelleg≈±. √âlesben: backend, adatb√°zis, szerveroldali e-mail.
- Chat kulcs: a kliensben l√°tszik; √©lesben proxyzd szerverrel.
`;

    // Az √ºzenet √∂ssze√°ll√≠t√°sa: rendszer prompt + tud√°sb√°zis + felhaszn√°l√≥i k√©rd√©s
    function buildMessages(userMessage) {
      const context = `
[Felhaszn√°l√≥i k√©rd√©s]
${userMessage}

[Alkalmaz√°s tud√°sb√°zis]
${KB}
`;
      return [
        { role: "system", content: SYSTEM_PROMPT },
        { role: "system", content: context },
        { role: "user", content: userMessage }
      ];
    }

    async function askOpenRouter(message) {
      const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + OPENROUTER_API_KEY,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: MODEL,
          messages: buildMessages(message),
        })
      });
      const data = await res.json();
      if (data.error) throw new Error(data.error.message || "Ismeretlen hiba az OpenRouter v√°laszban.");
      return data.choices[0]?.message?.content || "Nincs tartalom a v√°laszban.";
    }

    const chat = document.getElementById('chat');
    const promptEl = document.getElementById('prompt');
    const sendBtn = document.getElementById('sendBtn');

    function addBubble(text, cls){
      const b = document.createElement('div');
      b.className = 'bubble ' + cls;
      b.textContent = text;
      chat.appendChild(b);
      chat.scrollTop = chat.scrollHeight;
    }

    sendBtn.addEventListener('click', async () => {
      const text = promptEl.value.trim();
      if (!text) return;
      addBubble(text, 'user');
      promptEl.value = '';
      addBubble('Gondolkodom‚Ä¶', 'bot');
      try {
        const answer = await askOpenRouter(text);
        chat.lastChild.textContent = answer;
      } catch(e) {
        chat.lastChild.textContent = 'Nem siker√ºlt v√°laszolni: ' + e.message + ' ‚Ä¢ Tipp: ellen≈ërizd az API kulcsot/kv√≥t√°t, pr√≥b√°ld √∫jra k√©s≈ëbb. Ha k√∂zben gyors seg√≠ts√©g kell: Coin v√°s√°rl√°s a coins.html oldalon, fa√ºltet√©s az app.html f≈ëoldalon, vissza gomb az app.html#treesSection szekci√≥hoz. Bejelentkez√©s/login.html, regisztr√°ci√≥/register.html.';
      }
    });
  </script>
</body>
</html>

